<!doctype html>

<html lang="fr">
<head>
  <meta charset="utf-8">
  <title>MinecraftJS</title>
  <link rel="icon" href="assets/images/favicon.png">
  <link href="styles/game.css" rel="stylesheet">
  <script type="text/javascript" src="js/textures.js"></script>
  <script type="text/javascript" src="js/world.js"></script>
  <script type="text/javascript" src="js/world-structures.js"></script>
  <script type="text/javascript" src="js/randomizer.js"></script>
  <script type="text/javascript" src="js/Player.js"></script>
  <script type="text/javascript">
  		// Spritesheet
		var spriteSheetWidth = 256; // TODO : récupérer witdh image
		var spriteSheetHeight = 256;
		var spriteSheetCols = 16;
		var spriteSheetRows = 16;
		var worldCols = 40;
		var worldRows = 32; 
		var ctx;
		var canvas;
		var spriteSheetImg;
		var newSonic;
		var newSonicImg = new Image();

		// Sprite
		var spriteWidth = (spriteSheetWidth / spriteSheetCols);
		var spriteHeight = (spriteSheetHeight / spriteSheetRows);

		// Layers of the world
		const SKY_LAYER = 5;
		const GRASS_LAYER = 6;
		const DIRT_LAYER = 8;
		const STONE_OR_DIRT_LAYER = 13;
		const STONE_LAYER = 32;
		const DIAMOND_LAYER = 37;
		const STONE_OR_BEDROCK_LAYER = 39;
		const BEDROCK_LAYER = 40;

		// Player
		var player = Object.create(Player);
		var ultimatePlayer;

		// Control
		var keyState = {}; 

		/*
			TODO : idées pour le jeu
			- sonic saute et peut casser des cubes lorsqu'il saute et se met en boule
			- plateforme se détruit aléatoirement et le but est de rester le plus longtemps possible en vie
			- timer et sonic doit descendre le plus vite possible chercher diamant/ring et le ramener dans un coffre
			- scrolling horizontal et sonic doit sauter de plaforme en plateforme pour rester en vie
		*/

		function initializeLevel() {
			canvas = document.getElementById("canvas");
			canvas.focus(); // set focus on canvas so eventListener is triggered whithout clicking on the canvas



			canvas.addEventListener('keydown', function(e) {
			    keyState[e.keyCode || e.which] = true; // keyCode and which are legacy and should be replaced by code
			}, true);    
			canvas.addEventListener('keyup', function(e) {
			    keyState[e.keyCode || e.which] = false;
			}, true);
			//canvas.addEventListener('keydown', handleKeyPress);
			//canvas.addEventListener('keyup', keyUp);

		    if (canvas.getContext) {
		    	ctx = canvas.getContext("2d");
		    	// remove unexpected space between tiles
		    	ctx.imageSmoothingEnabled = false;

		    	ctx.scale(3, 3);

				//newSonic = Object.create(WalkAnimation);
				ultimatePlayer = Object.create(ultimatePlayer);
        	}

			spriteSheetImg = new Image();
			spriteSheetImg.src = "assets/images/texture.png";
			spriteSheetImg.onload = start;

			newSonicImg.src = "assets/images/sonic-tilesheet.png";
		}

		function gameLoop() {
			window.requestAnimationFrame(gameLoop);

			if (keyState[39] || keyState[68]){
			    ultimatePlayer.walkAnimation.render(ultimatePlayer.posX+=2);
			} else {
				ultimatePlayer.idleAnimation.render(ultimatePlayer.posX, ultimatePlayer.posY);
			}

			//newSonic.update();
			//newSonic.render();
			ultimatePlayer.update();
			ultimatePlayer.render();
		}



		function start() {
			drawWorld();

			gameLoop();
			// TODO : Instancier Steve quand le monde a fini son initialisation
			//drawPlayer();
			ultimatePlayer.idleAnimation.render(ultimatePlayer.posX, ultimatePlayer.posY);
		}
  </script>

</head>
<body onload="initializeLevel()">
	<div class="container">		
		<canvas width=1536 height=1920 class="sliding-background canvas-background"></canvas>
		<canvas id="canvas" width=1536 height=1920 class="canvas-game" tabindex="1"></canvas>
	</div>
</body>
</html>